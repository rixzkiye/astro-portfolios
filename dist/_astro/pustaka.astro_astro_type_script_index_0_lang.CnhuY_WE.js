document.addEventListener("DOMContentLoaded",()=>{const w=document.getElementById("search-container"),a=document.getElementById("search-input"),b=document.getElementById("filter-toggle-btn"),u=document.getElementById("dynamic-filter-container"),l=document.getElementById("search-results-preview"),C=document.getElementById("main-filter-section"),r=document.getElementById("main-filter-tabs"),v=document.getElementById("dynamic-filter-tabs"),k=document.querySelectorAll("[data-category-filter]"),p=document.querySelectorAll(".content-item"),B=document.getElementById("no-results"),I=document.getElementById("stats-section"),S=document.getElementById("content-grid");let o="all",c="all",i="",L=[];p.forEach(e=>{L.push({title:e.dataset.title,description:e.dataset.description,searchableContent:e.dataset.searchableContent,href:e.dataset.href,type:e.dataset.type,element:e})});const h=(e,n)=>{if(!n||!e)return e;const t=new RegExp(`(${n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")})`,"gi");return e.replace(t,"<mark>$1</mark>")},x=()=>{S.querySelectorAll("mark").forEach(n=>{const t=n.parentNode;t&&(t.replaceChild(document.createTextNode(n.textContent),n),t.normalize())})},g=()=>{x();let e=0;const n=o!=="all"||c!=="all"||i!=="",t=i!=="";I.classList.toggle("section-hidden",n),C.classList.toggle("section-hidden",t),p.forEach(s=>{const $=s.dataset.type,q=s.dataset.category,T=s.dataset.featured==="true",_=s.dataset.searchableContent;let d=!0;if(o!=="all"&&(o==="featured"?T||(d=!1):$!==o&&(d=!1)),c!=="all"&&q!==c&&(d=!1),i&&(_.includes(i)||(d=!1)),d){if(s.classList.remove("hidden"),e++,i){const m=s.querySelector("h3"),y=s.querySelector("p");m&&(m.innerHTML=h(m.textContent,i)),y&&(y.innerHTML=h(y.textContent,i))}}else s.classList.add("hidden")}),B.classList.toggle("hidden",e>0)},F=()=>{const e=a.value.toLowerCase();if(e.length<2){l.classList.remove("visible");return}const n=L.filter(t=>t.searchableContent.includes(e)).slice(0,5);n.length>0?(l.innerHTML=n.map(t=>{const s=t.type==="project"?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>';return`
                <a href="${t.href}" class="preview-item">
                    <div class="preview-item__icon">${s}</div>
                    <div class="preview-item__content">
                        <div class="preview-item__title">${h(t.title,e)}</div>
                        <div class="preview-item__desc">${t.description}</div>
                    </div>
                </a>
            `}).join(""),l.classList.add("visible")):l.classList.remove("visible")},f=e=>{if(r){r.querySelectorAll("button").forEach(s=>s.classList.remove("active"));const t=r.querySelector(`[data-filter="${e}"]`);t&&t.classList.add("active")}v.querySelectorAll("button").forEach(t=>t.classList.remove("active"));const n=v.querySelector(`[data-filter="${e}"]`);n&&n.classList.add("active")};b.addEventListener("click",e=>{e.stopPropagation(),u.classList.toggle("visible")}),a.addEventListener("input",()=>{i=a.value.toLowerCase(),g(),F()}),document.addEventListener("click",e=>{w.contains(e.target)||(u.classList.remove("visible"),l.classList.remove("visible"))});const E=e=>{const n=e.target.closest("button");n&&(o=n.dataset.filter,c="all",a.value="",i="",l.classList.remove("visible"),f(o),g(),u.classList.remove("visible"))};r&&r.addEventListener("click",E),v.addEventListener("click",E),k.forEach(e=>{e.addEventListener("click",()=>{c=e.dataset.categoryFilter,o="all",a.value="",i="",l.classList.remove("visible"),f("all"),document.getElementById("search-container").scrollIntoView({behavior:"smooth",block:"center"}),g()})}),f("all")});
