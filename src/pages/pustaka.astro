---
// src/pages/pustaka.astro
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import ProjectCard from "../components/ProjectCard.astro";
import PaperCard from "../components/PaperCard.astro";

// --- Data Fetching & Processing ---
const projects = await getCollection(
Â  "projects",
Â  ({ data }) => data.status === "published"
);
const papers = await getCollection(
Â  "papers",
Â  ({ data }) => data.status === "published"
);

const allContent = [
Â  ...projects.map((item) => ({ ...item, type: "project" as const })),
Â  ...papers.map((item) => ({ ...item, type: "paper" as const })),
].sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const featuredContent = allContent.filter((item) => item.data.featured);

const categoryCounts = allContent.reduce(
Â  (acc, item) => {
Â  Â  const category = item.data.category;
Â  Â  if (category) {
Â  Â  Â  acc[category] = (acc[category] || 0) + 1;
Â  Â  }
Â  Â  return acc;
Â  },
Â  {} as Record<string, number>
);

const stats = {
Â  totalProjects: projects.length,
Â  totalPapers: papers.length,
Â  totalContent: allContent.length,
Â  categories: {
Â  Â  code: categoryCounts.code || 0,
Â  Â  music: categoryCounts.music || 0,
Â  Â  video: categoryCounts.video || 0,
Â  Â  esai: categoryCounts.esai || 0,
Â  Â  puisi: categoryCounts.puisi || 0,
Â  Â  artikel: categoryCounts.artikel || 0,
Â  Â  cerpen: categoryCounts.cerpen || 0,
Â  },
};
---

<Layout
Â  title="Library - My Work"
Â  description="Explore the complete collection of my projects and writings. Find new inspiration and insights from all my creative and intellectual work."
>
Â  <!-- Hero Section -->
Â  <section class="relative py-24 px-4 sm:px-6 lg:px-8">
Â  Â  <div
Â  Â  Â  class="absolute inset-0 -z-10 bg-light-background dark:bg-dark-background"
Â  Â  >
Â  Â  Â  <div
Â  Â  Â  Â  class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-light-accent/10 dark:bg-dark-accent/10 rounded-full filter blur-3xl animate-pulse"
Â  Â  Â  >
Â  Â  Â  </div>
Â  Â  Â  <div
Â  Â  Â  Â  class="absolute top-1/4 left-1/4 w-72 h-72 bg-blue-500/5 rounded-full filter blur-3xl animate-pulse"
Â  Â  Â  Â  style="animation-delay: 2s;"
Â  Â  Â  >
Â  Â  Â  </div>
Â  Â  Â  <div
Â  Â  Â  Â  class="absolute bottom-1/4 right-1/4 w-72 h-72 bg-purple-500/5 rounded-full filter blur-3xl animate-pulse"
Â  Â  Â  Â  style="animation-delay: 4s;"
Â  Â  Â  >
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="max-w-4xl mx-auto text-center">
Â  Â  Â  <h1
Â  Â  Â  Â  class="text-4xl md:text-6xl font-bold text-light-text dark:text-dark-text mb-6"
Â  Â  Â  >
Â  Â  Â  Â  Digital <span class="text-gradient">Library</span>
Â  Â  Â  </h1>
Â  Â  Â  <p
Â  Â  Â  Â  class="text-xl text-light-muted dark:text-dark-muted max-w-2xl mx-auto mb-8"
Â  Â  Â  >
Â  Â  Â  Â  Explore the complete collection of my work - from tech projects to creative writings.
Â  Â  Â  </p>

Â  Â  Â  <!-- Search Container -->
Â  Â  Â  <div id="search-container" class="relative max-w-2xl mx-auto z-50">
Â  Â  Â  Â  <div class="relative flex items-center w-full">
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none z-10"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <svg
Â  Â  Â  Â  Â  Â  Â  class="h-5 w-5 text-gray-400"
Â  Â  Â  Â  Â  Â  Â  fill="none"
Â  Â  Â  Â  Â  Â  Â  stroke="currentColor"
Â  Â  Â  Â  Â  Â  Â  viewBox="0 0 24 24"
Â  Â  Â  Â  Â  Â  Â  ><path
Â  Â  Â  Â  Â  Â  Â  Â  stroke-linecap="round"
Â  Â  Â  Â  Â  Â  Â  Â  stroke-linejoin="round"
Â  Â  Â  Â  Â  Â  Â  Â  stroke-width="2"
Â  Â  Â  Â  Â  Â  Â  Â  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  id="search-input"
Â  Â  Â  Â  Â  Â  placeholder="Search by title, description, or tag..."
Â  Â  Â  Â  Â  Â  class="w-full pl-12 pr-12 py-3 rounded-lg border border-light-border/50 dark:border-dark-border/50 bg-light-surface/50 dark:bg-dark-surface/50 backdrop-blur-sm focus:ring-2 focus:ring-light-accent dark:focus:ring-dark-accent focus:outline-none transition-all"
Â  Â  Â  Â  Â  Â  autocomplete="off"
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  id="filter-toggle-btn"
Â  Â  Â  Â  Â  Â  class="absolute inset-y-0 right-0 px-4 flex items-center text-light-muted dark:text-dark-muted hover:text-light-text dark:hover:text-dark-text transition-colors"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <svg
Â  Â  Â  Â  Â  Â  Â  xmlns="http://www.w3.org/2000/svg"
Â  Â  Â  Â  Â  Â  Â  width="20"
Â  Â  Â  Â  Â  Â  Â  height="20"
Â  Â  Â  Â  Â  Â  Â  viewBox="0 0 24 24"
Â  Â  Â  Â  Â  Â  Â  fill="none"
Â  Â  Â  Â  Â  Â  Â  stroke="currentColor"
Â  Â  Â  Â  Â  Â  Â  stroke-width="2"
Â  Â  Â  Â  Â  Â  Â  stroke-linecap="round"
Â  Â  Â  Â  Â  Â  Â  stroke-linejoin="round"
Â  Â  Â  Â  Â  Â  Â  ><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"
Â  Â  Â  Â  Â  Â  Â  ></polygon></svg
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Filter Dropdown -->
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  id="dynamic-filter-container"
Â  Â  Â  Â  Â  class="absolute top-full right-0 mt-2 w-64 bg-light-surface/80 dark:bg-dark-surface/80 backdrop-blur-md border border-light-border/50 dark:border-dark-border/50 rounded-lg shadow-2xl p-4 transition-all duration-300 ease-in-out opacity-0 scale-95 -translate-y-2 pointer-events-none z-[100]"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <p
Â  Â  Â  Â  Â  Â  class="text-sm font-semibold text-left mb-3 px-2 text-light-text dark:text-dark-text"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Filter by type
Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  <div class="flex flex-col gap-1" id="dynamic-filter-tabs">
Â  Â  Â  Â  Â  Â  <button class="filter-btn w-full text-left py-2 px-3 rounded-md transition-colors font-medium text-[var(--color-text-muted)] hover:bg-[rgba(var(--color-accent-rgb),0.1)] hover:text-[var(--color-text)]" data-filter="all"
Â  Â  Â  Â  Â  Â  Â  >All ({stats.totalContent})</button
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <button class="filter-btn w-full text-left py-2 px-3 rounded-md transition-colors font-medium text-[var(--color-text-muted)] hover:bg-[rgba(var(--color-accent-rgb),0.1)] hover:text-[var(--color-text)]" data-filter="project"
Â  Â  Â  Â  Â  Â  Â  >Projects ({stats.totalProjects})</button
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <button class="filter-btn w-full text-left py-2 px-3 rounded-md transition-colors font-medium text-[var(--color-text-muted)] hover:bg-[rgba(var(--color-accent-rgb),0.1)] hover:text-[var(--color-text)]" data-filter="paper"
Â  Â  Â  Â  Â  Â  Â  >Writings ({stats.totalPapers})</button
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <button class="filter-btn w-full text-left py-2 px-3 rounded-md transition-colors font-medium text-[var(--color-text-muted)] hover:bg-[rgba(var(--color-accent-rgb),0.1)] hover:text-[var(--color-text)]" data-filter="featured"
Â  Â  Â  Â  Â  Â  Â  >Featured ({featuredContent.length})</button
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Search Results Preview -->
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  id="search-results-preview"
Â  Â  Â  Â  Â  class="absolute top-full left-0 right-0 mt-2 bg-light-surface/80 dark:bg-dark-surface/80 backdrop-blur-md border border-light-border/50 dark:border-dark-border/50 rounded-lg shadow-2xl overflow-hidden text-left transition-all duration-200 ease-in-out opacity-0 scale-95 pointer-events-none z-90"
Â  Â  Â  Â  >
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>

Â  <!-- Desktop Filter Buttons -->
Â  <section id="main-filter-section" class="px-4 sm:px-6 lg:px-8 mb-12 transition-all duration-500 ease-in-out">
Â  Â  <div class="max-w-7xl mx-auto">
Â  Â  Â  <div id="main-filter-tabs" class="hidden md:flex flex-wrap justify-center gap-2 md:gap-4">
Â  Â  Â  Â  <button class="px-4 py-2 rounded-lg border transition-all duration-300 font-medium" data-filter="all">All ({stats.totalContent})</button>
Â  Â  Â  Â  <button class="px-4 py-2 rounded-lg border transition-all duration-300 font-medium" data-filter="project">Projects ({stats.totalProjects})</button>
Â  Â  Â  Â  <button class="px-4 py-2 rounded-lg border transition-all duration-300 font-medium" data-filter="paper">Writings ({stats.totalPapers})</button>
Â  Â  Â  Â  <button class="px-4 py-2 rounded-lg border transition-all duration-300 font-medium" data-filter="featured">Featured ({featuredContent.length})</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>

Â  <!-- Content Grid -->
Â  <section class="px-4 sm:px-6 lg:px-8 pb-20">
Â  Â  <div class="max-w-7xl mx-auto">
Â  Â  Â  <div
Â  Â  Â  Â  id="content-grid"
Â  Â  Â  Â  class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
Â  Â  Â  >
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  allContent.map((item, index) => {
Â  Â  Â  Â  Â  Â  const searchableContent =
Â  Â  Â  Â  Â  Â  Â  `${item.data.title} ${item.data.description} ${item.data.tags?.join(" ")}`.toLowerCase();
Â  Â  Â  Â  Â  Â  const href =
Â  Â  Â  Â  Â  Â  Â  item.type === "project"
Â  Â  Â  Â  Â  Â  Â  Â  ? `/projects/${item.slug}`
Â  Â  Â  Â  Â  Â  Â  Â  : `/papers/${item.slug}`;
Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  Â  Â  class="content-item"
Â  Â  Â  Â  Â  Â  Â  Â  style={`--animation-delay: ${index * 75}ms;`}
Â  Â  Â  Â  Â  Â  Â  Â  data-type={item.type}
Â  Â  Â  Â  Â  Â  Â  Â  data-category={item.data.category}
Â  Â  Â  Â  Â  Â  Â  Â  data-featured={String(item.data.featured)}
Â  Â  Â  Â  Â  Â  Â  Â  data-searchable-content={searchableContent}
Â  Â  Â  Â  Â  Â  Â  Â  data-title={item.data.title}
Â  Â  Â  Â  Â  Â  Â  Â  data-description={item.data.description}
Â  Â  Â  Â  Â  Â  Â  Â  data-slug={item.slug}
Â  Â  Â  Â  Â  Â  Â  Â  data-href={href}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  {item.type === "project" ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <ProjectCard {...item.data} slug={item.slug} />
Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <PaperCard {...item.data} slug={item.slug} />
Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  })
Â  Â  Â  Â  }
Â  Â  Â  </div>
Â  Â  Â  <div id="no-results" class="hidden text-center py-20">
Â  Â  Â  Â  <div class="text-6xl mb-4 animate-wiggle">ðŸ¤·</div>
Â  Â  Â  Â  <h2 class="text-2xl font-bold">No Results Found</h2>
Â  Â  Â  Â  <p class="text-light-muted dark:text-dark-muted">Try using different keywords or filters.</p>
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>

Â  <!-- Category Section -->
Â  <section
Â  Â  class="py-20 px-4 sm:px-6 lg:px-8 bg-light-surface dark:bg-dark-surface"
Â  >
Â  Â  <div class="max-w-7xl mx-auto">
Â  Â  Â  <div class="text-center mb-12">
Â  Â  Â  Â  <h2 class="text-3xl font-bold">Explore by Category</h2>
Â  Â  Â  Â  <p class="text-light-muted dark:text-dark-muted">Find content that matches your interests</p>
Â  Â  Â  </div>
Â  Â  Â  <div
Â  Â  Â  Â  id="category-filter-buttons"
        class="flex space-x-4 lg:grid lg:grid-cols-7 lg:gap-6 lg:space-x-0 overflow-x-auto pb-4 -mx-4 px-4"
Â  Â  Â  Â  style="-webkit-overflow-scrolling: touch; scrollbar-width: none; -ms-overflow-style: none;"
Â  Â  Â  >
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  data-category-filter="code"
Â  Â  Â  Â  Â  class="category-btn flex-shrink-0 w-36 lg:w-auto p-6 rounded-xl text-center bg-light-background dark:bg-dark-background border border-light-border dark:border-dark-border transition-all duration-300 ease-in-out hover:scale-105 hover:border-light-accent dark:hover:border-dark-accent hover:shadow-xl hover:shadow-light-accent/10 dark:hover:shadow-dark-accent/10"
Â  Â  Â  Â  Â  ><div class="text-3xl mb-2">ðŸ’»</div><div class="font-semibold">
Â  Â  Â  Â  Â  Â  Code
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  {stats.categories.code}
Â  Â  Â  Â  Â  </div></button
Â  Â  Â  Â  >
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  data-category-filter="music"
Â  Â  Â  Â  Â  class="category-btn flex-shrink-0 w-36 lg:w-auto p-6 rounded-xl text-center bg-light-background dark:bg-dark-background border border-light-border dark:border-dark-border transition-all duration-300 ease-in-out hover:scale-105 hover:border-light-accent dark:hover:border-dark-accent hover:shadow-xl hover:shadow-light-accent/10 dark:hover:shadow-dark-accent/10"
Â  Â  Â  Â  Â  ><div class="text-3xl mb-2">ðŸŽµ</div><div class="font-semibold">
Â  Â  Â  Â  Â  Â  Music
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  {stats.categories.music}
Â  Â  Â  Â  Â  </div></button
Â  Â  Â  Â  >
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  data-category-filter="video"
Â  Â  Â  Â  Â  class="category-btn flex-shrink-0 w-36 lg:w-auto p-6 rounded-xl text-center bg-light-background dark:bg-dark-background border border-light-border dark:border-dark-border transition-all duration-300 ease-in-out hover:scale-105 hover:border-light-accent dark:hover:border-dark-accent hover:shadow-xl hover:shadow-light-accent/10 dark:hover:shadow-dark-accent/10"
Â  Â  Â  Â  Â  ><div class="text-3xl mb-2">ðŸŽ¬</div><div class="font-semibold">
Â  Â  Â  Â  Â  Â  Video
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  {stats.categories.video}
Â  Â  Â  Â  Â  </div></button
Â  Â  Â  Â  >
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  data-category-filter="esai"
Â  Â  Â  Â  Â  class="category-btn flex-shrink-0 w-36 lg:w-auto p-6 rounded-xl text-center bg-light-background dark:bg-dark-background border border-light-border dark:border-dark-border transition-all duration-300 ease-in-out hover:scale-105 hover:border-light-accent dark:hover:border-dark-accent hover:shadow-xl hover:shadow-light-accent/10 dark:hover:shadow-dark-accent/10"
Â  Â  Â  Â  Â  ><div class="text-3xl mb-2">ðŸ“„</div><div class="font-semibold">
Â  Â  Â  Â  Â  Â  Essays
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  {stats.categories.esai}
Â  Â  Â  Â  Â  </div></button
Â  Â  Â  Â  >
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  data-category-filter="puisi"
Â  Â  Â  Â  Â  class="category-btn flex-shrink-0 w-36 lg:w-auto p-6 rounded-xl text-center bg-light-background dark:bg-dark-background border border-light-border dark:border-dark-border transition-all duration-300 ease-in-out hover:scale-105 hover:border-light-accent dark:hover:border-dark-accent hover:shadow-xl hover:shadow-light-accent/10 dark:hover:shadow-dark-accent/10"
Â  Â  Â  Â  Â  ><div class="text-3xl mb-2">âœ¨</div><div class="font-semibold">
Â  Â  Â  Â  Â  Â  Poetry
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  {stats.categories.puisi}
Â  Â  Â  Â  Â  </div></button
Â  Â  Â  Â  >
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  data-category-filter="artikel"
Â  Â  Â  Â  Â  class="category-btn flex-shrink-0 w-36 lg:w-auto p-6 rounded-xl text-center bg-light-background dark:bg-dark-background border border-light-border dark:border-dark-border transition-all duration-300 ease-in-out hover:scale-105 hover:border-light-accent dark:hover:border-dark-accent hover:shadow-xl hover:shadow-light-accent/10 dark:hover:shadow-dark-accent/10"
Â  Â  Â  Â  Â  ><div class="text-3xl mb-2">ðŸ“°</div><div class="font-semibold">
Â  Â  Â  Â  Â  Â  Articles
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  {stats.categories.artikel}
Â  Â  Â  Â  Â  </div></button
Â  Â  Â  Â  >
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  data-category-filter="cerpen"
Â  Â  Â  Â  Â  class="category-btn flex-shrink-0 w-36 lg:w-auto p-6 rounded-xl text-center bg-light-background dark:bg-dark-background border border-light-border dark:border-dark-border transition-all duration-300 ease-in-out hover:scale-105 hover:border-light-accent dark:hover:border-dark-accent hover:shadow-xl hover:shadow-light-accent/10 dark:hover:shadow-dark-accent/10"
Â  Â  Â  Â  Â  ><div class="text-3xl mb-2">ðŸ”¥</div><div class="font-semibold">
Â  Â  Â  Â  Â  Â  Short Stories
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  {stats.categories.cerpen}
Â  Â  Â  Â  Â  </div></button
Â  Â  Â  Â  >
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>
Â  
Â  <!-- Stats Section -->
Â  <section
Â  Â  id="stats-section"
Â  Â  class="px-4 sm:px-6 lg:px-8 py-20"
Â  >
Â  Â  <div class="max-w-7xl mx-auto">
Â  Â  Â  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  class="p-6 rounded-xl text-center bg-light-surface/50 dark:bg-dark-surface/50 border border-light-border/50 dark:border-dark-border/50 backdrop-blur-sm transition hover:bg-light-surface dark:hover:bg-dark-surface"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="text-3xl font-bold text-light-accent dark:text-dark-accent mb-2"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  {stats.totalContent}
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  Total Works
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  class="p-6 rounded-xl text-center bg-light-surface/50 dark:bg-dark-surface/50 border border-light-border/50 dark:border-dark-border/50 backdrop-blur-sm transition hover:bg-light-surface dark:hover:bg-dark-surface"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="text-3xl font-bold text-light-accent dark:text-dark-accent mb-2"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  {stats.totalProjects}
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  Projects
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  class="p-6 rounded-xl text-center bg-light-surface/50 dark:bg-dark-surface/50 border border-light-border/50 dark:border-dark-border/50 backdrop-blur-sm transition hover:bg-light-surface dark:hover:bg-dark-surface"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="text-3xl font-bold text-light-accent dark:text-dark-accent mb-2"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  {stats.totalPapers}
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  Writings
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  class="p-6 rounded-xl text-center bg-light-surface/50 dark:bg-dark-surface/50 border border-light-border/50 dark:border-dark-border/50 backdrop-blur-sm transition hover:bg-light-surface dark:hover:bg-dark-surface"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="text-3xl font-bold text-light-accent dark:text-dark-accent mb-2"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  {featuredContent.length}
Â  Â  Â  Â  Â  </div><div class="text-sm text-light-muted dark:text-dark-muted">
Â  Â  Â  Â  Â  Â  Featured
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>
</Layout>

<style is:global>
Â  @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
Â  @keyframes wiggle { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }
Â  .animate-wiggle { animation: wiggle 0.5s ease-in-out infinite; }
Â  .content-item { animation: fadeInUp 0.6s ease-out forwards; animation-delay: var(--animation-delay, 0ms); opacity: 0; }
Â  .content-item.hidden { display: none; }
Â  mark { background-color: var(--color-accent-transparent); color: var(--color-accent); padding: 1px 2px; border-radius: 3px; }
Â  #dynamic-filter-container.visible, #search-results-preview.visible { opacity: 1; transform: scale(1) translateY(0); pointer-events: auto; }
Â  .preview-item { display: flex; align-items: center; gap: 1rem; padding: 0.75rem 1rem; transition: background-color 0.2s ease-in-out; text-decoration: none; color: inherit; }
Â  .preview-item:hover { background-color: rgba(var(--color-accent-rgb), 0.1); }
Â  .preview-item:not(:last-child) { border-bottom: 1px solid var(--color-border); }
Â  .preview-item__icon { flex-shrink: 0; width: 2.5rem; height: 2.5rem; border-radius: 0.5rem; display: grid; place-items: center; background-color: rgba(var(--color-accent-rgb), 0.08); }
Â  .preview-item__icon svg { width: 1.25rem; height: 1.25rem; color: var(--color-accent); }
Â  .preview-item__content { flex-grow: 1; overflow: hidden; }
Â  .preview-item__title { font-weight: 600; color: var(--color-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
Â  .preview-item__desc { font-size: 0.875rem; color: var(--color-text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
Â  .section-hidden { display: none !important; }
</style>

<script is:inline>
 document.addEventListener("DOMContentLoaded", () => {
    const searchContainer = document.getElementById("search-container");
    const searchInput = document.getElementById("search-input");
    const filterToggleButton = document.getElementById("filter-toggle-btn");
    const dynamicFilterContainer = document.getElementById("dynamic-filter-container");
    const searchResultsPreview = document.getElementById("search-results-preview");
    const mainFilterSection = document.getElementById("main-filter-section");
    const mainFilterTabs = document.getElementById("main-filter-tabs");
    const dynamicFilterTabs = document.getElementById("dynamic-filter-tabs");
    const categoryButtonContainer = document.getElementById("category-filter-buttons");
    const contentItems = document.querySelectorAll(".content-item");
    const noResults = document.getElementById("no-results");
    
    if (!searchContainer || !searchInput || !dynamicFilterTabs || !mainFilterTabs || !categoryButtonContainer) return;

    let currentTypeFilter = "all";
    let currentCategoryFilter = "all";
    let currentSearch = "";

    const searchableData = Array.from(contentItems).map(item => {
        const el = item;
        return {
            title: el.dataset.title ?? '',
            description: el.dataset.description ?? '',
            searchableContent: el.dataset.searchableContent ?? '',
            href: el.dataset.href ?? '#',
            type: el.dataset.type ?? '',
            element: el,
        }
    });

    const highlightText = (text, query) => {
        if (!query || !text) return text;
        const regex = new RegExp(`(${query.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&")})`, "gi");
        return text.replace(regex, `<mark>$1</mark>`);
    };

    const applyFilters = () => {
        let visibleCount = 0;
        const isSearching = currentSearch !== "";
        
        mainFilterSection?.classList.toggle("section-hidden", isSearching);

        contentItems.forEach((item) => {
            const el = item;
            const type = el.dataset.type ?? '';
            const category = el.dataset.category ?? '';
            const isFeatured = el.dataset.featured === "true";
            const searchableContent = el.dataset.searchableContent ?? '';

            const typeMatch = currentTypeFilter === 'all' || (currentTypeFilter === 'featured' ? isFeatured : type === currentTypeFilter);
            const categoryMatch = currentCategoryFilter === 'all' || category === currentCategoryFilter;
            const searchMatch = !currentSearch || searchableContent.includes(currentSearch);
            
            const showItem = typeMatch && categoryMatch && searchMatch;
            el.classList.toggle("hidden", !showItem);
            if (showItem) visibleCount++;
        });
        noResults?.classList.toggle("hidden", visibleCount > 0);
    };

    const updateSearchPreview = () => {
        if (!searchResultsPreview || !searchInput.value) {
            searchResultsPreview?.classList.remove("visible");
            return;
        }
        const query = searchInput.value.toLowerCase();
        if (query.length < 2) {
            searchResultsPreview.classList.remove("visible");
            return;
        }
        const filteredResults = searchableData.filter(item => item.searchableContent.includes(query)).slice(0, 5);
        if (filteredResults.length > 0) {
            searchResultsPreview.innerHTML = filteredResults.map(item => {
                const icon = item.type === "project"
                    ? `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>`;
                return `<a href="${item.href}" class="preview-item"><div class="preview-item__icon">${icon}</div><div class="preview-item__content"><div class="preview-item__title">${highlightText(item.title, query)}</div><div class="preview-item__desc">${item.description}</div></div></a>`;
            }).join("");
            searchResultsPreview.classList.add("visible");
        } else {
            searchResultsPreview.classList.remove("visible");
        }
    };
    
    const syncActiveFilterState = (activeFilter) => {
        const activeClasses = ['bg-light-accent', 'dark:bg-dark-accent', 'text-white', 'border-transparent'];
        const inactiveClasses = ['text-light-muted', 'dark:text-dark-muted', 'hover:text-light-text', 'dark:hover:text-dark-text', 'hover:bg-light-surface', 'dark:hover:bg-dark-surface', 'border-light-border', 'dark:border-dark-border'];

        mainFilterTabs.querySelectorAll("button").forEach(b => {
            b.classList.remove(...activeClasses, ...inactiveClasses);
            b.classList.add(...(b.dataset.filter === activeFilter ? activeClasses : inactiveClasses));
        });
        dynamicFilterTabs.querySelectorAll("button").forEach(b => {
            b.classList.toggle('active', b.dataset.filter === activeFilter);
            b.classList.toggle('bg-[var(--color-accent)]', b.dataset.filter === activeFilter);
            b.classList.toggle('text-white', b.dataset.filter === activeFilter);
            b.classList.toggle('font-semibold', b.dataset.filter === activeFilter);
        });
    };

    filterToggleButton?.addEventListener("click", (e) => {
        e.stopPropagation();
        dynamicFilterContainer?.classList.toggle("visible");
    });

    searchInput.addEventListener("input", () => {
        currentSearch = searchInput.value.toLowerCase();
        applyFilters();
        updateSearchPreview();
    });

    searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            searchResultsPreview?.classList.remove('visible');
        }
    });

    document.addEventListener("click", (e) => {
        if (e.target instanceof Node && !searchContainer.contains(e.target)) {
            dynamicFilterContainer?.classList.remove("visible");
            searchResultsPreview?.classList.remove("visible");
        }
    });

    const handleFilterClick = (e) => {
        const target = e.target.closest("button");
        if (!target || !searchInput) return;
        currentTypeFilter = target.dataset.filter ?? 'all';
        currentCategoryFilter = "all";
        searchInput.value = "";
        currentSearch = "";
        searchResultsPreview?.classList.remove("visible");
        syncActiveFilterState(currentTypeFilter);
        applyFilters();
        dynamicFilterContainer?.classList.remove("visible");
    };

    mainFilterTabs.addEventListener("click", handleFilterClick);
    dynamicFilterTabs.addEventListener("click", handleFilterClick);

    categoryButtonContainer.addEventListener("click", (e) => {
        const btn = e.target.closest(".category-btn");
        if (!btn || !searchInput) return;

        currentCategoryFilter = btn.dataset.categoryFilter ?? 'all';
        currentTypeFilter = "all"; // Reset type filter
        searchInput.value = "";
        currentSearch = "";
        searchResultsPreview?.classList.remove("visible");
        
        // Visually reset main filters
        syncActiveFilterState('all'); 
        
        // Scroll to the content grid smoothly
        const contentGrid = document.getElementById('content-grid');
        contentGrid?.scrollIntoView({ behavior: 'smooth', block: 'start' });

        applyFilters();
    });

    syncActiveFilterState("all");
    applyFilters();
});
</script>
